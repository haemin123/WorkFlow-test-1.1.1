import{c as p,r as l,m as n,j as e,a as S,n as T}from"./index-BWhNYll5.js";import{U as k}from"./user-C8BhFaIl.js";import{T as q}from"./trash-2-D4YKPC91.js";const z=p("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),E=p("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),V=p("UserCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),B=({currentUser:r})=>{const[s,i]=l.useState(null),[I,U]=l.useState(!0),[b,y]=l.useState(!1),[u,m]=l.useState(null),[j,g]=l.useState(null),f=l.useRef(null),[N,w]=l.useState(!1),[c,v]=l.useState(""),[P,C]=l.useState(""),[d,x]=l.useState("");l.useEffect(()=>{L()},[r]);const L=async()=>{if(r)try{const a=await n.getUserProfile(r.uid);a&&(i(a),a.profileImageUrl&&m(a.profileImageUrl))}catch(a){console.error(a)}finally{U(!1)}},o=a=>{s&&i({...s,[a.target.name]:a.target.value})},R=a=>{if(a.target.files&&a.target.files[0]){const t=a.target.files[0];g(t);const h=new FileReader;h.onloadend=()=>{m(h.result)},h.readAsDataURL(t)}},M=async()=>{if(confirm("프로필 이미지를 삭제하시겠습니까?")&&!(!r||!s)){w(!0);try{await n.deleteProfileImage(r.uid),await n.updateUserProfile(r.uid,{...s,profileImageUrl:""}),i({...s,profileImageUrl:""}),m(null),g(null),alert("이미지가 삭제되었습니다.")}catch(a){alert("삭제 실패: "+a.message)}finally{w(!1)}}},D=async a=>{if(a.preventDefault(),!(!s||!r)){y(!0);try{let t=s.profileImageUrl;j&&(t=await n.uploadProfileImage(r.uid,j)),await n.updateUserProfile(r.uid,{...s,profileImageUrl:t}),i({...s,profileImageUrl:t}),g(null),alert("프로필이 업데이트되었습니다.")}catch(t){alert("업데이트 실패: "+t.message)}finally{y(!1)}}},F=async a=>{if(a.preventDefault(),c!==P){x("비밀번호가 일치하지 않습니다.");return}if(c.length<6){x("비밀번호는 6자 이상이어야 합니다.");return}try{await n.changePassword(c),x("비밀번호가 변경되었습니다."),v(""),C("")}catch(t){x("변경 실패: "+t.message)}};return I?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(S,{className:"animate-spin text-gray-400"})}):s?e.jsxs("div",{className:"max-w-4xl mx-auto p-8 animate-fade-in",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-8 flex items-center gap-3",children:[e.jsx(V,{className:"w-8 h-8 text-blue-600"}),"프로필 관리"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8 pb-8 border-b border-gray-100",children:[e.jsxs("div",{className:"relative group mb-4",children:[e.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg bg-gray-100",children:u?e.jsx("img",{src:u,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(k,{className:"w-16 h-16"})})}),e.jsx("button",{type:"button",onClick:()=>{var a;return(a=f.current)==null?void 0:a.click()},className:"absolute bottom-0 right-0 p-2.5 bg-blue-600 text-white rounded-full shadow-md hover:bg-blue-700 transition-all group-hover:scale-110",title:"이미지 변경",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",ref:f,onChange:R,accept:"image/*",className:"hidden"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{var a;return(a=f.current)==null?void 0:a.click()},className:"text-sm font-bold text-blue-600 hover:underline",children:"이미지 선택"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("button",{type:"button",onClick:M,disabled:N,className:"text-sm font-bold text-red-500 hover:underline flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"})," 삭제"]})]})]})]}),e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-gray-400"}),"기본 정보"]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"이메일 (변경 불가)"}),e.jsx("input",{type:"email",value:s.email,disabled:!0,className:"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-500 cursor-not-allowed"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"이름"}),e.jsx("input",{name:"name",type:"text",value:s.name,onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"본부"}),e.jsx("input",{name:"department",type:"text",value:s.department||"",onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"팀"}),e.jsx("input",{name:"team",type:"text",value:s.team||"",onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"직급"}),e.jsx("input",{name:"position",type:"text",value:s.position||"",onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"직책"}),e.jsx("input",{name:"jobTitle",type:"text",value:s.jobTitle||"",onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:b||N,className:"flex items-center gap-2 px-6 py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-black transition-colors disabled:opacity-70",children:[b?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"변경사항 저장"})]})})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-gray-400"}),"비밀번호 변경"]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("input",{type:"password",placeholder:"새 비밀번호",value:c,onChange:a=>v(a.target.value),className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"}),e.jsx("input",{type:"password",placeholder:"새 비밀번호 확인",value:P,onChange:a=>C(a.target.value),className:"w-full p-3 border border-gray-200 rounded-xl outline-none focus:border-blue-500 transition-colors"}),d&&e.jsx("p",{className:`text-xs font-bold ${d.includes("실패")||d.includes("일치하지")?"text-red-500":"text-green-500"}`,children:d}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-white border border-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",children:"비밀번호 변경"})]})]})})]})]}):e.jsx("div",{className:"p-8 text-center text-gray-500",children:"프로필 정보를 불러올 수 없습니다."})};export{B as ProfilePage};
